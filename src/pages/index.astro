---
import TerminalLayout from '../layouts/TerminalLayout.astro';
import resumeEn from '../data/resume.json';
import resumePl from '../data/resume_pl.json';
import projectsEn from '../data/projects.json';
import projectsPl from '../data/projects_pl.json';
import { ui, icons, services } from '../data/siteConfig';

// --- TYPE DEFINITIONS ---
interface Award { title: string; issuer: string; date: string; }
interface Certificate { name: string; issuer: string; date: string; }
interface Education { institution: string; area: string; startDate: string; endDate: string; }

// Simplified Project Definition
interface Project { 
    id: string; 
    title: string; 
    role: string; 
    tech: string[]; 
    summary: string; 
    problem?: string[];
    solution?: string[];
    architecture?: string[];
    result?: string[];
}

interface ResumeData { awards?: Award[]; certificates?: Certificate[]; education?: Education[]; [key: string]: any; }

// --- DATA LOGIC ---
const getSortedAchievements = (data: ResumeData) => {
    const awards = (data.awards || []).map((a: Award) => ({ ...a, type: 'award', displayTitle: a.title }));
    const certs = (data.certificates || []).map((c: Certificate) => ({ ...c, type: 'cert', displayTitle: c.name }));
    return [...awards, ...certs].sort((a, b) => {
        const getYear = (d: string) => {
            const match = d.match(/\d{4}/);
            return match ? parseInt(match[0]) : 0;
        };
        return getYear(b.date) - getYear(a.date);
    });
};

const sortedAchievementsEn = getSortedAchievements(resumeEn);
const sortedAchievementsPl = getSortedAchievements(resumePl);
---

<TerminalLayout title={`${resumeEn.basics.name} - DevOps Engineer`} description={resumeEn.basics.summary}>
    
    <header class="mb-12 border-b border-gray-800 pb-8 relative">
        <div class="lang-en">
            <h1 class="text-5xl font-bold text-gray-100 mb-2 text-glow">{resumeEn.basics.name}</h1>
            <h2 class="text-2xl text-gray-400 mb-6">{resumeEn.basics.label}</h2>
            <p class="text-gray-400 max-w-2xl text-sm italic mb-6 border-l-2 border-gray-700 pl-4">{resumeEn.basics.summary}</p>
        </div>
        <div class="lang-pl hidden">
            <h1 class="text-5xl font-bold text-gray-100 mb-2 text-glow">{resumePl.basics.name}</h1>
            <h2 class="text-2xl text-gray-400 mb-6">{resumePl.basics.label}</h2>
            <p class="text-gray-400 max-w-2xl text-sm italic mb-6 border-l-2 border-gray-700 pl-4">{resumePl.basics.summary}</p>
        </div>

        <div class="flex flex-wrap gap-6 text-sm text-gray-400 mt-6 print:text-black">
            <div class="flex items-center gap-2 hover:text-green-400 transition-colors">
                <span class="lang-en">üìç {resumeEn.basics.location}</span>
                <span class="lang-pl hidden">üìç {resumePl.basics.location}</span>
            </div>
            {resumeEn.basics.github && (
                <a href={`https://github.com/${resumeEn.basics.github}`} target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 hover:text-green-400 transition-colors">
                    <span class="w-5 h-5" set:html={icons.github} />
                    GitHub
                </a>
            )}
            {resumeEn.basics.linkedin && (
                <a href={resumeEn.basics.linkedin} target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 hover:text-green-400 transition-colors">
                    <span class="w-5 h-5" set:html={icons.linkedin} />
                    LinkedIn
                </a>
            )}
        </div>
    </header>

    <section class="mb-12 break-inside-avoid">
        <h3 class="text-xl font-bold text-white mb-4 border-b border-gray-800 inline-block text-glow">
            <span class="lang-en">{ui.skills_header.en}</span>
            <span class="lang-pl hidden">{ui.skills_header.pl}</span>
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <span class="text-purple-400 text-sm block mb-2">> 
                    <span class="lang-en">{ui.backend_scan.en}</span>
                    <span class="lang-pl hidden">{ui.backend_scan.pl}</span>
                </span>
                <div class="flex flex-wrap gap-2 lang-en">
                    {resumeEn.skills.backend.map((skill: string) => (
                        <span class="bg-gray-800 text-gray-300 px-2 py-1 text-xs rounded hover:bg-green-900 hover:text-white transition-colors cursor-default border border-gray-700">{skill}</span>
                    ))}
                </div>
                <div class="flex flex-wrap gap-2 lang-pl hidden">
                    {resumePl.skills.backend.map((skill: string) => (
                        <span class="bg-gray-800 text-gray-300 px-2 py-1 text-xs rounded hover:bg-green-900 hover:text-white transition-colors cursor-default border border-gray-700">{skill}</span>
                    ))}
                </div>
            </div>
            <div>
                <span class="text-purple-400 text-sm block mb-2">> 
                    <span class="lang-en">{ui.devops_scan.en}</span>
                    <span class="lang-pl hidden">{ui.devops_scan.pl}</span>
                </span>
                <div class="flex flex-wrap gap-2 lang-en">
                    {resumeEn.skills.devops.map((skill: string) => (
                        <span class="bg-gray-800 text-gray-300 px-2 py-1 text-xs rounded hover:bg-green-900 hover:text-white transition-colors cursor-default border border-gray-700">{skill}</span>
                    ))}
                </div>
                <div class="flex flex-wrap gap-2 lang-pl hidden">
                    {resumePl.skills.devops.map((skill: string) => (
                        <span class="bg-gray-800 text-gray-300 px-2 py-1 text-xs rounded hover:bg-green-900 hover:text-white transition-colors cursor-default border border-gray-700">{skill}</span>
                    ))}
                </div>
            </div>
        </div>
    </section>

    <section class="mb-12">
        <h3 class="text-xl font-bold text-white mb-6 border-b border-gray-800 inline-block text-glow">
            <span class="lang-en">{ui.experience_header.en}</span>
            <span class="lang-pl hidden">{ui.experience_header.pl}</span>
        </h3>
        
        <div class="space-y-8 lang-en">
            {resumeEn.work.map((job: any) => (
                <div class="relative pl-6 border-l border-gray-700 hover:border-green-500 transition-colors duration-300 break-inside-avoid">
                    <div class="absolute -left-[5px] top-0 w-2.5 h-2.5 bg-gray-700 rounded-full"></div>
                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-baseline mb-2">
                        <h4 class="text-lg font-bold text-gray-100">{job.position}</h4>
                        <span class="text-sm text-gray-500 font-bold">{job.startDate} ‚Äî {job.endDate}</span>
                    </div>
                    <div class="text-purple-400 text-sm mb-2">@ {job.company}</div>
                    <ul class="list-none space-y-1">
                        {job.highlights.map((item: string) => <li class="text-gray-400 text-sm flex items-start"><span class="mr-2 text-green-500 opacity-50">></span>{item}</li>)}
                    </ul>
                </div>
            ))}
        </div>

        <div class="space-y-8 lang-pl hidden">
            {resumePl.work.map((job: any) => (
                <div class="relative pl-6 border-l border-gray-700 hover:border-green-500 transition-colors duration-300 break-inside-avoid">
                    <div class="absolute -left-[5px] top-0 w-2.5 h-2.5 bg-gray-700 rounded-full"></div>
                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-baseline mb-2">
                        <h4 class="text-lg font-bold text-gray-100">{job.position}</h4>
                        <span class="text-sm text-gray-500 font-bold">{job.startDate} ‚Äî {job.endDate}</span>
                    </div>
                    <div class="text-purple-400 text-sm mb-2">@ {job.company}</div>
                    <ul class="list-none space-y-1">
                        {job.highlights.map((item: string) => <li class="text-gray-400 text-sm flex items-start"><span class="mr-2 text-green-500 opacity-50">></span>{item}</li>)}
                    </ul>
                </div>
            ))}
        </div>
    </section>

    <section class="mb-12 break-inside-avoid">
        <h3 class="text-xl font-bold text-white mb-6 border-b border-gray-800 inline-block text-glow">
            <span class="lang-en">{ui.education_header.en}</span>
            <span class="lang-pl hidden">{ui.education_header.pl}</span>
        </h3>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="lang-en contents">
                {resumeEn.education?.map((edu: Education) => (
                    <div class="border border-gray-800 bg-gray-900/20 p-4 rounded hover:border-blue-500/50 transition-colors group">
                        <div class="flex items-start justify-between mb-2">
                            <span class="text-blue-400 group-hover:text-blue-300" set:html={icons.university} />
                            <span class="text-xs text-gray-600 border border-gray-800 px-1 rounded">{ui.lbl_field.en}</span>
                        </div>
                        <h4 class="font-bold text-gray-200 text-sm mb-1">{edu.area}</h4>
                        <div class="text-xs text-purple-400 mb-1">{edu.institution}</div>
                        <div class="text-xs text-gray-500 font-mono">{edu.startDate} - {edu.endDate}</div>
                    </div>
                ))}
            </div>
            <div class="lang-pl contents hidden">
                {resumePl.education?.map((edu: Education) => (
                    <div class="border border-gray-800 bg-gray-900/20 p-4 rounded hover:border-blue-500/50 transition-colors group">
                        <div class="flex items-start justify-between mb-2">
                            <span class="text-blue-400 group-hover:text-blue-300" set:html={icons.university} />
                            <span class="text-xs text-gray-600 border border-gray-800 px-1 rounded">{ui.lbl_field.pl}</span>
                        </div>
                        <h4 class="font-bold text-gray-200 text-sm mb-1">{edu.area}</h4>
                        <div class="text-xs text-purple-400 mb-1">{edu.institution}</div>
                        <div class="text-xs text-gray-500 font-mono">{edu.startDate} - {edu.endDate}</div>
                    </div>
                ))}
            </div>
        </div>
    </section>

    <section class="mb-12 break-inside-avoid">
        <h3 class="text-xl font-bold text-white mb-6 border-b border-gray-800 inline-block text-glow">
            <span class="lang-en">{ui.achievements_header.en}</span>
            <span class="lang-pl hidden">{ui.achievements_header.pl}</span>
        </h3>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="lang-en contents">
                {sortedAchievementsEn.map((item) => (
                    <div class={`border p-4 rounded transition-colors group ${item.type === 'award' ? 'border-yellow-900/40 bg-yellow-900/10 hover:border-yellow-500/50' : 'border-gray-800 bg-gray-900/20 hover:border-green-500/50'}`}>
                        <div class="flex items-start justify-between mb-2">
                            <span class={`${item.type === 'award' ? 'text-yellow-500 group-hover:text-yellow-300' : 'text-green-400 group-hover:text-green-300'}`} set:html={item.type === 'award' ? icons.trophy : icons.cert} />
                            <span class={`text-xs border px-1 rounded ${item.type === 'award' ? 'text-yellow-600/80 border-yellow-900/50' : 'text-gray-600 border-gray-800'}`}>
                                {item.type === 'award' ? ui.lbl_award.en : ui.lbl_cert.en}
                            </span>
                        </div>
                        <h4 class="font-bold text-gray-200 text-sm mb-1">{item.displayTitle}</h4>
                        <div class="flex justify-between text-xs text-gray-500 font-mono mt-2">
                            <span>{item.issuer}</span>
                            <span>{item.date}</span>
                        </div>
                    </div>
                ))}
            </div>

            <div class="lang-pl contents hidden">
                {sortedAchievementsPl.map((item) => (
                    <div class={`border p-4 rounded transition-colors group ${item.type === 'award' ? 'border-yellow-900/40 bg-yellow-900/10 hover:border-yellow-500/50' : 'border-gray-800 bg-gray-900/20 hover:border-green-500/50'}`}>
                        <div class="flex items-start justify-between mb-2">
                            <span class={`${item.type === 'award' ? 'text-yellow-500 group-hover:text-yellow-300' : 'text-green-400 group-hover:text-green-300'}`} set:html={item.type === 'award' ? icons.trophy : icons.cert} />
                            <span class={`text-xs border px-1 rounded ${item.type === 'award' ? 'text-yellow-600/80 border-yellow-900/50' : 'text-gray-600 border-gray-800'}`}>
                                {item.type === 'award' ? ui.lbl_award.pl : ui.lbl_cert.pl}
                            </span>
                        </div>
                        <h4 class="font-bold text-gray-200 text-sm mb-1">{item.displayTitle}</h4>
                        <div class="flex justify-between text-xs text-gray-500 font-mono mt-2">
                            <span>{item.issuer}</span>
                            <span>{item.date}</span>
                        </div>
                    </div>
                ))}
            </div>
        </div>
    </section>

    <section class="mb-12 break-inside-avoid">
        <h3 class="text-xl font-bold text-white mb-6 border-b border-gray-800 inline-block text-glow">
            <span class="lang-en">{ui.projects_header.en}</span>
            <span class="lang-pl hidden">{ui.projects_header.pl}</span>
        </h3>

        <div class="grid grid-cols-1 gap-4 lang-en">
            {projectsEn.map((project: any) => (
                <div class="border border-gray-800 bg-gray-900/10 p-6 rounded hover:bg-gray-800/20 transition-colors group relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-2 opacity-20 group-hover:opacity-40 transition-opacity">
                        <span class="text-gray-500" set:html={icons.file} />
                    </div>
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <h4 class="font-bold text-gray-100 text-lg mb-1">{project.title}</h4>
                            <div class="text-xs text-purple-400 font-mono mb-2">> Role: {project.role}</div>
                        </div>
                    </div>
                    <p class="text-sm text-gray-400 mb-4 leading-relaxed">{project.summary}</p>
                    <div class="flex flex-wrap gap-2 mb-6">
                        {project.tech.map((t: string) => <span class="text-xs bg-gray-800 text-gray-300 px-2 py-0.5 rounded">{t}</span>)}
                    </div>
                    
                    <button 
                        class="relative z-20 text-xs font-bold flex items-center gap-2 project-trigger border border-green-800 bg-green-900/20 px-3 py-1.5 rounded hover:bg-green-500 hover:text-black hover:border-green-500 transition-all w-fit cursor-pointer"
                        data-id={`en-${project.id}`}
                    >
                        {ui.lbl_read_more.en}
                    </button>
                    
                    <script type="application/json" id={`data-en-${project.id}`} set:html={JSON.stringify(project)} />
                </div>
            ))}
        </div>

        <div class="grid grid-cols-1 gap-4 lang-pl hidden">
            {projectsPl.map((project: any) => (
                <div class="border border-gray-800 bg-gray-900/10 p-6 rounded hover:bg-gray-800/20 transition-colors group relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-2 opacity-20 group-hover:opacity-40 transition-opacity">
                        <span class="text-gray-500" set:html={icons.file} />
                    </div>
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <h4 class="font-bold text-gray-100 text-lg mb-1">{project.title}</h4>
                            <div class="text-xs text-purple-400 font-mono mb-2">> Rola: {project.role}</div>
                        </div>
                    </div>
                    <p class="text-sm text-gray-400 mb-4 leading-relaxed">{project.summary}</p>
                    <div class="flex flex-wrap gap-2 mb-6">
                        {project.tech.map((t: string) => <span class="text-xs bg-gray-800 text-gray-300 px-2 py-0.5 rounded">{t}</span>)}
                    </div>
                    
                    <button 
                        class="relative z-20 text-xs font-bold flex items-center gap-2 project-trigger border border-green-800 bg-green-900/20 px-3 py-1.5 rounded hover:bg-green-500 hover:text-black hover:border-green-500 transition-all w-fit cursor-pointer"
                        data-id={`pl-${project.id}`}
                    >
                        {ui.lbl_read_more.pl}
                    </button>

                    <script type="application/json" id={`data-pl-${project.id}`} set:html={JSON.stringify(project)} />
                </div>
            ))}
        </div>
    </section>

    <section class="mb-12 break-inside-avoid print:hidden">
        <h3 class="text-xl font-bold text-white mb-6 border-b border-gray-800 inline-block text-glow">
            <span class="lang-en">{ui.services_header.en}</span>
            <span class="lang-pl hidden">{ui.services_header.pl}</span>
        </h3>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            {services.map((service) => (
                <div class="border border-gray-800 bg-gray-900/10 p-4 rounded hover:bg-gray-800/30 hover:border-blue-500/50 transition-all group">
                    <div class="mb-3 text-blue-400 group-hover:text-blue-300" set:html={service.icon} />
                    <h4 class="font-bold text-gray-200 text-sm mb-2">
                        <span class="lang-en">{service.title.en}</span>
                        <span class="lang-pl hidden">{service.title.pl}</span>
                    </h4>
                    <p class="text-xs text-gray-500 leading-relaxed">
                        <span class="lang-en">{service.desc.en}</span>
                        <span class="lang-pl hidden">{service.desc.pl}</span>
                    </p>
                </div>
            ))}
        </div>
    </section>

    <section class="mb-12 break-inside-avoid print:hidden">
        <h3 class="text-xl font-bold text-white mb-6 border-b border-gray-800 inline-block text-glow">
            <span class="lang-en">{ui.contact_header.en}</span>
            <span class="lang-pl hidden">{ui.contact_header.pl}</span>
        </h3>
        
        <div class="border border-gray-700 p-8 rounded bg-gray-900/30 hover:border-green-500 transition-colors text-center">
            <div class="text-purple-400 text-sm mb-4 font-bold">> 
                <span class="lang-en">{ui.protocol_linkedin.en}</span>
                <span class="lang-pl hidden">{ui.protocol_linkedin.pl}</span>
            </div>
            <p class="text-gray-400 mb-8 max-w-2xl mx-auto text-sm">
                <span class="lang-en">{ui.contact_desc.en}</span>
                <span class="lang-pl hidden">{ui.contact_desc.pl}</span>
            </p>

            {resumeEn.basics.linkedin && (
                <a href={resumeEn.basics.linkedin} target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-3 bg-green-900/20 text-green-400 border border-green-800 px-6 py-3 rounded hover:bg-green-500 hover:text-black transition-all font-bold text-base group">
                    <span class="w-5 h-5 group-hover:animate-bounce" set:html={icons.linkedin} />
                    <span class="lang-en">{ui.btn_linkedin.en}</span>
                    <span class="lang-pl hidden">{ui.btn_linkedin.pl}</span>
                </a>
            )}
        </div>
    </section>

    <div id="project-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden items-center justify-center z-50 p-4">
        <div class="bg-[#0d1117] border border-green-900 w-full max-w-2xl rounded shadow-2xl flex flex-col max-h-[80vh]">
            <div class="bg-gray-900 p-3 border-b border-gray-800 flex justify-between items-center">
                <div class="flex gap-2">
                    <div class="w-3 h-3 rounded-full bg-red-500"></div>
                    <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                    <div class="w-3 h-3 rounded-full bg-green-500"></div>
                </div>
                <div class="text-gray-500 text-xs font-mono" id="modal-title-bar">project_log.txt</div>
                <button id="close-modal" class="text-gray-500 hover:text-white cursor-pointer">
                    <span class="w-5 h-5" set:html={icons.close} />
                </button>
            </div>
            <div class="p-6 overflow-y-auto font-mono text-sm text-gray-300 leading-relaxed" id="modal-body"></div>
            <div class="p-3 border-t border-gray-800 bg-gray-900/50 text-xs text-gray-600 font-mono flex justify-between">
                <span>MODE: READ-ONLY</span>
                <span class="lang-en">{ui.lbl_close_file.en} [ESC]</span>
                <span class="lang-pl hidden">{ui.lbl_close_file.pl} [ESC]</span>
            </div>
        </div>
    </div>

    <script is:inline define:vars={{ headers: { 
        problem: { en: ui.proj_problem.en, pl: ui.proj_problem.pl },
        solution: { en: ui.proj_solution.en, pl: ui.proj_solution.pl },
        arch: { en: ui.proj_arch.en, pl: ui.proj_arch.pl },
        result: { en: ui.proj_result.en, pl: ui.proj_result.pl }
    }}}>
        // MODAL LOGIC (Robust Event Delegation)
        document.addEventListener('DOMContentLoaded', () => {
            const modal = document.getElementById('project-modal');
            const modalBody = document.getElementById('modal-body');
            const modalTitle = document.getElementById('modal-title-bar');
            
            // Function to open Modal
            function openModal(contentId, title) {
                const dataScript = document.getElementById(`data-${contentId}`);
                
                if (!dataScript) {
                    console.error(`Data not found for element: #data-${contentId}`);
                    return;
                }

                if (!modal || !modalBody) {
                    console.error("Critical: Modal DOM elements missing.");
                    return;
                }

                try {
                    // Use textContent to get the raw JSON string
                    const project = JSON.parse(dataScript.textContent);
                    const lang = contentId.startsWith('en-') ? 'en' : 'pl';
                    
                    let html = '';

                    // 1. PROBLEM
                    if (project.problem && project.problem.length > 0) {
                        html += `<h5 class="text-purple-400 font-bold text-base mt-2 mb-2 uppercase border-b border-gray-800 pb-1 w-fit">${headers.problem[lang]}</h5>`;
                        project.problem.forEach(text => html += `<p class="mb-2 text-gray-300">${text}</p>`);
                    }

                    // 2. SOLUTION
                    if (project.solution && project.solution.length > 0) {
                        html += `<h5 class="text-purple-400 font-bold text-base mt-6 mb-2 uppercase border-b border-gray-800 pb-1 w-fit">${headers.solution[lang]}</h5>`;
                        html += `<ul class="space-y-2 mb-4">`;
                        project.solution.forEach(item => {
                            html += `<li class="flex items-start"><span class="text-green-500/70 mr-2 mt-0.5">></span><span>${item}</span></li>`;
                        });
                        html += `</ul>`;
                    }

                    // 3. ARCHITECTURE (Optional)
                    if (project.architecture && project.architecture.length > 0) {
                        html += `<h5 class="text-purple-400 font-bold text-base mt-6 mb-2 uppercase border-b border-gray-800 pb-1 w-fit">${headers.arch[lang]}</h5>`;
                        project.architecture.forEach(text => html += `<p class="mb-2 text-gray-300">${text}</p>`);
                    }

                    // 4. RESULT
                    if (project.result && project.result.length > 0) {
                        html += `<h5 class="text-purple-400 font-bold text-base mt-6 mb-2 uppercase border-b border-gray-800 pb-1 w-fit">${headers.result[lang]}</h5>`;
                        html += `<ul class="space-y-2 mb-4">`;
                        project.result.forEach(item => {
                            html += `<li class="flex items-start"><span class="text-yellow-500/70 mr-2 mt-0.5">‚úî</span><span>${item}</span></li>`;
                        });
                        html += `</ul>`;
                    }

                    modalBody.innerHTML = html;
                    if(modalTitle) modalTitle.textContent = `${title.toLowerCase().replace(/\s+/g, '_')}.log`;
                    
                    modal.classList.remove('hidden');
                    modal.classList.add('flex');
                    document.body.style.overflow = 'hidden'; // Lock background scrolling
                } catch (e) {
                    console.error("JSON Parse Error:", e);
                }
            }

            function closeModal() {
                if (modal) {
                    modal.classList.add('hidden');
                    modal.classList.remove('flex');
                    document.body.style.overflow = ''; // Unlock background scrolling
                }
            }

            // --- GLOBAL CLICK LISTENER (DELEGATION) ---
            document.addEventListener('click', (e) => {
                // 1. Handle Open Button (READ LOG)
                const triggerBtn = e.target.closest('.project-trigger');
                if (triggerBtn) {
                    e.preventDefault(); 
                    const id = triggerBtn.dataset.id;
                    
                    const card = triggerBtn.closest('.group'); 
                    const titleElement = card ? card.querySelector('h4') : null;
                    const title = titleElement ? titleElement.textContent : 'project'; 
                    
                    if (id) openModal(id, title);
                    return;
                }

                // 2. Handle Close Button (X)
                const closeBtn = e.target.closest('#close-modal');
                if (closeBtn) {
                    closeModal();
                    return;
                }

                // 3. Handle Click Outside Modal
                if (e.target === modal) {
                    closeModal();
                }
            });

            // Handle ESC key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && modal && !modal.classList.contains('hidden')) {
                    closeModal();
                }
            });
        });
    </script>

</TerminalLayout>